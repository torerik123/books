{% extends "layout.html" %}

{% block title %}
    {{ title }}
{% endblock %}

{% block main %}

{{ style_section | safe }}

    <div class="book-container">
        <div class="book-info-cover">
            <div class="cover">
                <img class="cover-img" id="cover-img"></div>
            </div>

        <div class="book-info-content">
            <div class="book-info-col">
                <h1 class="book-name">{{ title }}, {{ year }}</h1>
                <div class="author-isbn">Author: <a href="{{ url_for('results', search = author ) }}"><span class="author">{{ author }}</span></a> , <span class="book-isbn">ISBN: <span id="isbn">{{ isbn }}</span> </span> </div>
                <div class="rating">Rating: <span id="rating"></span></div>
                <p class="book-info-description" id="description"></p>
                
                <div class="review-content">
                    {{ content_section | safe }} 
               </div>
                    
            </div>
        </div>  
    </div>


<script>
    
    // Get cover on book info page
    document.addEventListener("DOMContentLoaded", () => {

    const isbn = document.querySelector("#isbn").innerHTML;

    const cover = document.querySelector("#cover-img");

    // Get JSON response from Google Books API
    fetch('https://www.googleapis.com/books/v1/volumes?q=isbn:' + isbn)
    .then(response => response.json())
    .then(data => {
        console.log(data);
        // Get thumbnail image
        const image = data['items'][0]['volumeInfo']['imageLinks']['thumbnail'];
        
        // Set cover to image link
        cover.src = image;
        
        // Insert description
        const description = document.querySelector("#description");
        description.innerHTML = data['items'][0]['volumeInfo']['description']; 
        

        // Rating
        const rating = document.querySelector("#rating");
        rating.innerHTML = data['items'][0]['volumeInfo']['averageRating'] + "/5";
        
        });
    });
    
</script>
{% endblock %}