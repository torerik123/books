{% extends "layout.html" %}

{% block title %}
Book review
{% endblock %}

<nav>
    LINK 1 | LINK 2 | LINK 3
</nav>

{% block main %}
<div id="content"></div>
<a href="{{ url_for('reviews', isbn = '9780380795277') }}"> REVIEWS</a>

  <div class="index-slider">
    <div class="bestsellers">
        <div class="slider">
            
            <h1>Best sellers</h1>
            
            <!--Carousel-->
            <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                <div class="carousel-inner">

                    {% for i in range(7) %}

                        {% if i == 0 %}
                            <div class="carousel-item active">
                                <img class="d-block w-100" id="slider0" src="..." alt="Slide number {{i+1}}">
                            </div>
                        {% else %}
                            <div class="carousel-item">
                                <img class="d-block w-100" id="slider{{i}}" src="..." alt="Slide number {{i+1}}">
                            </div>
                        {% endif %}
                    
                    {% endfor %}
                </div>

                <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
                </a>
            </div>
        </div>
    </div>
</div>    

<script>
const bestseller_isbns = [];

API_KEY = 'GmNm9aeq6FeIaUjHXriO80RCzGrWEHuS';

// Get bestsellers list from NYT API
fetch('https://api.nytimes.com/svc/books/v3/lists/best-sellers/history.json?api-key=' + API_KEY)
.then(response => response.json())
.then(data => {

  const bestsellers = data['results'];
  
  // Get title of top 10 best selling books
  for (i = 0; i < 10; i++) {
    
    // If no ISBN exists
    if (!bestsellers[i]['isbns'][0]) {
      
      // TODO: GET ISBN BY TITLE - CALL FUNCTION

      console.log("NO ISBN FOUND");
    }

    else {
      const isbn13 = bestsellers[i]['isbns'][0]['isbn13'];
      bestseller_isbns.push(parseInt(isbn13));      
    }      
  }

  let img_nr = 0;

  // Book covers front page
  bestseller_isbns.forEach(isbn => {
    
    // Get JSON response from Google Books API
    fetch('https://www.googleapis.com/books/v1/volumes?q=isbn:' + isbn)
    .then(response => response.json())
    .then(data => {
      
      // Get thumbnail image
      const image = data['items'][0]['volumeInfo']['imageLinks']['thumbnail'];

      // Get ID of slider element
      const carousel = document.querySelector("#slider" + img_nr);

      // Set source to image link
      carousel.src = image;  
      img_nr++;
      });
  });
});
</script>

{% endblock %}
</body>
</html>