{% extends "layout.html" %}

{% block title %}
Book review
{% endblock %}

{% block main %}
<!--Hero module-->
<div class="hero">
  <div class="jumbotron jumbotron-fluid">
    <div class="container">
      <h1 class="display-4">Is it any good?</h1>
      <p class="lead">Find book reviews by title, author or ISBN number</p>
    </div>
  </div>
</div>

<!--Search-->
<div class="content-search">  
  <div class="content-2">
    <div class="search-box">
      <form action="{{ url_for('search') }}" class="search-bar" method="post" class="form-inline">
        <div class="form-group">
          <input class="form-control mr-sm-2" type="search" list="book" id="allbooks" placeholder="Title / Author / ISBN" name="book_list" aria-label="Search" />
          <datalist id="book">
          
          {% for book in allbooks %}
            <option id="{{ book.id }}" value="{{ book.title }}" name="book_name">
          {% endfor %}
          
          </datalist>
          <button class="btn btn-success my-2 my-sm-0" type="submit">Search</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!--Bestsellers-->
<div class="card">
  <h5 class="card-header text-center">Best sellers</h5>
  <div class="card-body">
    <div class="row flex-row justify-content-center">
      <!--Cards-->
      <div class="col h-30">
        <div class="card w-50" style="width: 18rem;">
          <img class="card-img-top" id="coverimg0" src="/static/book.jpg" alt="Card image cap">
          <div class="card-body">
            <p class="card-text">Title <br> Author</p>
          </div>
        </div>

        <div class="card w-50" style="width: 18rem;">
          <img class="card-img-top" id="coverimg1" src="/static/book.jpg" alt="Card image cap">
          <div class="card-body">
            <p class="card-text">Title <br> Author</p>
          </div>
        </div>
      </div>

      <div class="col h-30">
        <div class="card w-50" style="width: 18rem;">
          <img class="card-img-top" id="coverimg2" src="/static/book.jpg" alt="Card image cap">
          <div class="card-body">
            <p class="card-text">Title <br> Author</p>
          </div>
        </div>

        <div class="card w-50" style="width: 18rem;">
          <img class="card-img-top" id="coverimg3" src="/static/book.jpg" alt="Card image cap">
          <div class="card-body">
            <p class="card-text">Title <br> Author</p>
          </div>
        </div>
      </div>

      <div class="col h-30">
        <div class="card w-50" style="width: 18rem;">
          <img class="card-img-top" id="coverimg4" src="/static/book.jpg" alt="Card image cap">
          <div class="card-body">
            <p class="card-text">Title <br> Author</p>
          </div>
        </div>
        
        <div class="card w-50" style="width: 18rem;">
          <img class="card-img-top" id="coverimg5" src="/static/book.jpg" alt="Card image cap">
          <div class="card-body">
            <p class="card-text">Title <br> Author</p>
          </div>
        </div>
    </div>
            
  <!--End card body-->  
  </div>

<!--End container-->
</div>

<!--Footer-->
<div class="content-search">  
  
</div> 





<script>
const bestseller_isbns = [];

API_KEY = 'GmNm9aeq6FeIaUjHXriO80RCzGrWEHuS';

// Get bestsellers list from NYT API
fetch('https://api.nytimes.com/svc/books/v3/lists/best-sellers/history.json?api-key=' + API_KEY)
.then(response => response.json())
.then(data => {

  const bestsellers = data['results'];
  
  // Get title of top 10 best selling books
  for (i = 0; i < 10; i++) {
    
    // If no ISBN exists
    if (!bestsellers[i]['isbns'][0]) {

      console.log("NO ISBN FOUND");
    }

    else {
      const isbn13 = bestsellers[i]['isbns'][0]['isbn13'];
      bestseller_isbns.push(parseInt(isbn13));      
    }      
  }

  let img_nr = 0;

  // Book covers front page
  bestseller_isbns.forEach(isbn => {
    
    // Get JSON response from Google Books API
    fetch('https://www.googleapis.com/books/v1/volumes?q=isbn:' + isbn)
    .then(response => response.json())
    .then(data => {
      
      // Get thumbnail image
      const image = data['items'][0]['volumeInfo']['imageLinks']['thumbnail'];

      // Get ID of slider element
      const carousel = document.querySelector("#coverimg" + img_nr);

      // Set source to image link
      carousel.src = image;  
      img_nr++;
      });
  });
});
</script>

{% endblock %}
</body>
</html>