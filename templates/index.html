{% extends "layout.html" %}

{% block title %}
Book review
{% endblock %}

{% block main %}
<div class="hero">
  <div class = "book"></div>
  <h1 class="hero-text">Is it any good?</h1>  
  <h4 class="intro-text">Find book reviews by title, author or ISBN number</h4>
</div>

<div class="content-search">  
  <div class="content-2">
    <!--Search-->
    <div class="search-box">
      <form action="{{ url_for('search') }}" class="search-bar" method="post" class="form-inline">
        <div class="form-group">
          <input class="form-control mr-sm-2" type="search" list="book" id="allbooks" placeholder="Title / Author / ISBN" name="book_list" aria-label="Search" />
          <datalist id="book">
          
          {% for book in allbooks %}
            <option id="{{ book.id }}" value="{{ book.title }}" name="book_name">
          {% endfor %}
          
          </datalist>
          <button class="btn btn-success my-2 my-sm-0" type="submit">Search</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="content-search-2">
  <!--Bestsellers-->
  
  <div class="card-container">
    <h1 class="header">Best sellers</h1>
    <div class="card-row">
      <div class="card"><img id="coverimg0"></div>
      <div class="card"><img id="coverimg1"></div>
      <div class="card"><img id="coverimg2"></div>
    </div>
    
    <div class="card-row">
      <div class="card"><img id="coverimg3"></div>
      <div class="card"><img id="coverimg4"></div>
      <div class="card"><img id="coverimg5"></div>
    </div> 
  </div>


  
</div>



<script>
const bestseller_isbns = [];

API_KEY = 'GmNm9aeq6FeIaUjHXriO80RCzGrWEHuS';

// Get bestsellers list from NYT API
fetch('https://api.nytimes.com/svc/books/v3/lists/best-sellers/history.json?api-key=' + API_KEY)
.then(response => response.json())
.then(data => {

  const bestsellers = data['results'];
  
  // Get title of top 10 best selling books
  for (i = 0; i < 10; i++) {
    
    // If no ISBN exists
    if (!bestsellers[i]['isbns'][0]) {

      console.log("NO ISBN FOUND");
    }

    else {
      const isbn13 = bestsellers[i]['isbns'][0]['isbn13'];
      bestseller_isbns.push(parseInt(isbn13));      
    }      
  }

  let img_nr = 0;

  // Book covers front page
  bestseller_isbns.forEach(isbn => {
    
    // Get JSON response from Google Books API
    fetch('https://www.googleapis.com/books/v1/volumes?q=isbn:' + isbn)
    .then(response => response.json())
    .then(data => {
      
      // Get thumbnail image
      const image = data['items'][0]['volumeInfo']['imageLinks']['thumbnail'];

      // Get ID of slider element
      const carousel = document.querySelector("#coverimg" + img_nr);

      // Set source to image link
      carousel.src = image;  
      img_nr++;
      });
  });
});
</script>

{% endblock %}
</body>
</html>